// Generated by CoffeeScript 1.4.0
(function() {
  var audio_buffer, context, file_input, init_sound, load_sound_file, play_sound, source, stop_sound;

  context = new window.webkitAudioContext();

  source = null;

  audio_buffer = null;

  stop_sound = function() {
    if (source) {
      return source.noteOff(0);
    }
  };

  play_sound = function() {
    source = context.createBufferSource();
    Array.prototype.reverse.call(audio_buffer.getChannelData(0));
    Array.prototype.reverse.call(audio_buffer.getChannelData(1));
    source.buffer = audio_buffer;
    source.loop = false;
    source.connect(context.destination);
    return source.noteOn(0);
  };

  init_sound = function(array_buffer) {
    return context.decodeAudioData(array_buffer, function(buffer) {
      var buttons;
      audio_buffer = buffer;
      buttons = document.querySelectorAll('button');
      return buttons[0].disabled = false;
    }, function(e) {
      return console.log('Error decoding file', e);
    });
  };

  file_input = document.querySelector('input[type="file"]');

  file_input.addEventListener('change', function(e) {
    var reader;
    reader = new FileReader();
    reader.onload = function(e) {
      return init_sound(this.result);
    };
    return reader.readAsArrayBuffer(this.files[0]);
  }, false);

  load_sound_file = function(url) {
    var xhr;
    xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.onload = function(e) {
      return init_sound(this.response);
    };
    return xhr.send();
  };

  window.stop_sound = stop_sound;

  window.play_sound = play_sound;

  window.load_sound_file = load_sound_file;

}).call(this);
